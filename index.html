<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>업무지원 확인서</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PDF, Excel 라이브러리 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f7;
      color: #222;
    }
    .layout {
      display: flex;
      min-height: 100vh;
    }
    .main {
      flex: 1;
      padding: 24px;
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 20px;
    }
    h1 {
      grid-column: 1 / -1;
      margin: 0 0 6px;
      font-size: 22px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .subtitle {
      grid-column: 1 / -1;
      font-size: 13px;
      color: #666;
      margin-bottom: 12px;
      text-align: center;
    }
    .card {
      background: #fff;
      border-radius: 18px;
      padding: 18px 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.06);
    }
    .card h2 {
      margin: 0 0 10px;
      font-size: 16px;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 10px;
      margin-bottom: 8px;
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }
    label {
      color: #555;
    }
    input, select {
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #d0d0d7;
      font-size: 13px;
      outline: none;
      background: #fff;
    }
    input:focus, select:focus {
      border-color: #ffb400;
      box-shadow: 0 0 0 1px rgba(255, 179, 0, 0.3);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #000;
      padding: 6px 4px;
      text-align: center;
    }
    th {
      background: #fafafa;
    }
    .btn-panel {
      width: 190px;
      padding: 24px 16px;
      border-left: 1px solid #e0e0e5;
      background: #fcfcfd;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .btn {
      border: none;
      border-radius: 999px;
      padding: 9px 14px;
      font-size: 13px;
      cursor: pointer;
      display: block;
      width: 100%;
      text-align: center;
      background: #ffcc33;
      font-weight: 600;
      color: #333;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    .btn-secondary {
      background: #fff;
      border: 1px solid #ddd;
      box-shadow: none;
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .preview-title {
      text-align: center;
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin: 8px 0;
    }
    .reg-text {
      font-size: 11px;
      line-height: 1.6;
    }
    .bottom-line {
      margin-top: 60px;  /* 아래로 더 내리기 */
      font-size: 12px;
      text-align: center;
      line-height: 2;
    }
    .reg-wrap {
      display: flex;
      align-items: center;
      gap: 4px;
      justify-content: center;
    }
    .reg-wrap span {
      font-size: 12px;
    }
    .reg-wrap input {
      max-width: 90px;
      text-align: center;
    }
    @media (max-width: 960px) {
      .layout {
        flex-direction: column;
      }
      .main {
        grid-template-columns: 1fr;
      }
      .btn-panel {
        width: 100%;
        border-left: none;
        border-top: 1px solid #e0e0e5;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
      }
      .btn {
        width: calc(50% - 10px);
      }
    }
  </style>
</head>
<body>
<div class="layout">
  <div class="main">
    <h1>업무지원 확인서</h1>
    <div class="subtitle">
      대출 실행 계약에 대한 주모집자·공동모집자의 업무지원을 확인하고,
      내부 수수료 배분(주 60% / 공동 40%) 근거로 활용하는 양식입니다.
    </div>

    <!-- 입력 카드 -->
    <div class="card" id="input-card">
      <h2>1. 대출 실행 계약 정보</h2>
      <div class="form-row">
        <div class="field">
          <label for="financialInstitution">금융기관</label>
          <input id="financialInstitution" value="신한은행" />
        </div>
        <div class="field">
          <label for="productName">상품명</label>
          <select id="productName">
            <option value="">상품명을 선택하세요</option>
            <!-- TODO: 필요 시 아래 option 복사해서 Excel 목록 그대로 추가 -->
            <option>주택담보대출</option>
            <option>일반자금대출(만기일시상환) 신한MYTAXI 행복대출</option>
            <option>일반자금대출(분할상환) 신한 MY CAR 대출(신차)</option>
            <option>일반자금대출(분할상환) 신한MYTAXI 행복대출</option>
            <option>일반자금대출 TOPS부동산대출(만기일시)</option>
            <option>일반자금대출 TOPS부동산대출(분할상환)</option>
            <option>주택자금대출 신한전세대출(서울보증)</option>
            <option>주택자금대출 신한전세대출(주택금융공사)</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="field">
          <label for="loanAmount">대출금액(원)</label>
          <input id="loanAmount" />
        </div>
        <div class="field">
          <label for="execDate">실행일자</label>
          <input id="execDate" type="date" />
        </div>
      </div>
      <div class="form-row">
        <div class="field">
          <label>등록번호(주모집자)</label>
          <div class="reg-wrap">
            <span>10-</span>
            <input id="regNoMainSuffix" maxlength="8" />
          </div>
        </div>
        <div class="field">
          <label for="groupNo">*단체협의번호(집단대출)</label>
          <input id="groupNo" />
        </div>
      </div>

      <h2 style="margin-top:18px;">2. 업무지원 참여자</h2>
      <table>
        <thead>
        <tr>
          <th style="width:80px;">구 분</th>
          <th>등록번호</th>
          <th>성명</th>
          <th>서명(수기작성)</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td>주모집자</td>
          <td>
            <div class="reg-wrap">
              <span>10-</span>
              <input id="mainRegNoSuffix" maxlength="8" />
            </div>
          </td>
          <td><input id="mainName" /></td>
          <td><input id="mainSign" /></td>
        </tr>
        <tr>
          <td>공동모집자</td>
          <td>
            <div class="reg-wrap">
              <span>10-</span>
              <input id="jointRegNoSuffix" maxlength="8" />
            </div>
          </td>
          <td><input id="jointName" /></td>
          <td><input id="jointSign" /></td>
        </tr>
        </tbody>
      </table>

      <div class="field" style="margin-top:14px;">
        <label for="teamNumber">관리팀(숫자로 입력)</label>
        <input id="teamNumber" placeholder="예: 1" />
      </div>
      <div class="field" style="margin-top:8px;">
        <label for="managerName">관리팀장 성명</label>
        <input id="managerName" placeholder="예: 홍길동" />
      </div>
    </div>

    <!-- 미리보기 / PDF 영역 -->
    <div class="card" id="preview-card">
      <div id="pdfArea">
        <div class="preview-title">업무지원 확인서</div>

        <!-- 1. 대출 실행 계약 정보 -->
        <div class="section-title">1. 대출 실행 계약 정보</div>
        <table style="margin-bottom:12px;">
          <thead>
          <tr>
            <th style="width:160px;">구분</th>
            <th>내용</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td>금융기관</td>
            <td id="pv_financialInstitution"></td>
          </tr>
          <tr>
            <td>상품명</td>
            <td id="pv_productName"></td>
          </tr>
          <tr>
            <td>대출금액(원)</td>
            <td id="pv_loanAmount"></td>
          </tr>
          <tr>
            <td>실행일자</td>
            <td id="pv_execDate"></td>
          </tr>
          <tr>
            <td>등록번호(주모집자)</td>
            <td id="pv_regNoMain"></td>
          </tr>
          <tr>
            <td>*단체협의번호(집단대출)</td>
            <td id="pv_groupNo"></td>
          </tr>
          </tbody>
        </table>

        <!-- 2. 업무지원 참여자 -->
        <div class="section-title">2. 업무지원 참여자</div>
        <table style="margin-bottom:12px;">
          <thead>
          <tr>
            <th style="width:80px;">구 분</th>
            <th>등록번호</th>
            <th>성명</th>
            <th>서명(수기작성)</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td>주모집자</td>
            <td id="pv_mainRegNo"></td>
            <td id="pv_mainName"></td>
            <td id="pv_mainSign"></td>
          </tr>
          <tr>
            <td>공동모집자</td>
            <td id="pv_jointRegNo"></td>
            <td id="pv_jointName"></td>
            <td id="pv_jointSign"></td>
          </tr>
          </tbody>
        </table>

        <!-- 3. 내부 정산 규정 -->
        <div class="section-title">3. 내부 정산 규정</div>
        <div class="reg-text">
          1) 업무지원 건의 수수료 배분은 회사 규정에 따라 <strong>주모집자 60%, 공동모집자 40%</strong> 비율로 고정하여 산정합니다.<br/>
          2) 대출실행계약과 관련한 민원, 리스크, 패널티는 주모집자에게 귀속됩니다.<br/>
          3) 본 문서는 관련 법령 및 회사 규정에 따라 5년간 보관됩니다.
        </div>

        <!-- 날짜 & 관리팀장 -->
        <div class="bottom-line">
          20&nbsp;&nbsp;&nbsp;&nbsp;년&nbsp;&nbsp;&nbsp;&nbsp;월&nbsp;&nbsp;&nbsp;&nbsp;일<br/><br/>
          모기지리더스&nbsp;
          <span id="pv_teamNumber"></span>팀&nbsp;
          관리팀장&nbsp;<span id="pv_managerName"></span>&nbsp;(서명)
        </div>
      </div>
    </div>
  </div>

  <!-- 버튼 패널 -->
  <div class="btn-panel">
    <button class="btn" id="btnPdf">PDF로 저장</button>
    <button class="btn btn-secondary" id="btnExcel">엑셀로 저장</button>
    <button class="btn btn-secondary" id="btnReset">입력 초기화</button>
  </div>
</div>

<script>
  // 숫자 포맷: 천 단위 콤마
  function formatNumberWithCommas(value) {
    const digits = value.replace(/[^\d]/g, '');
    if (!digits) return '';
    return digits.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }

  // 등록번호 10- 접두어
  function formatRegWithPrefix(id) {
    const el = document.getElementById(id);
    if (!el) return '';
    const digits = el.value.replace(/[^\d]/g, '').slice(0, 8);
    el.value = digits;
    if (!digits) return '';
    return '10-' + digits;
  }

  // 입력 → 미리보기 동기화
  function syncPreview() {
    const get = id => document.getElementById(id).value.trim();

    document.getElementById('pv_financialInstitution').innerText = get('financialInstitution');

    const productSelect = document.getElementById('productName');
    document.getElementById('pv_productName').innerText =
      productSelect.value || '';

    // 대출금액은 항상 콤마 포맷
    const loanInput = document.getElementById('loanAmount');
    loanInput.value = formatNumberWithCommas(loanInput.value);
    document.getElementById('pv_loanAmount').innerText = loanInput.value;

    document.getElementById('pv_execDate').innerText = get('execDate');

    document.getElementById('pv_regNoMain').innerText = formatRegWithPrefix('regNoMainSuffix');
    document.getElementById('pv_groupNo').innerText = get('groupNo');

    document.getElementById('pv_mainRegNo').innerText = formatRegWithPrefix('mainRegNoSuffix');
    document.getElementById('pv_mainName').innerText = get('mainName');
    document.getElementById('pv_mainSign').innerText = get('mainSign');

    document.getElementById('pv_jointRegNo').innerText = formatRegWithPrefix('jointRegNoSuffix');
    document.getElementById('pv_jointName').innerText = get('jointName');
    document.getElementById('pv_jointSign').innerText = get('jointSign');

    document.getElementById('pv_teamNumber').innerText = get('teamNumber');
    document.getElementById('pv_managerName').innerText = get('managerName');
  }

  function bindInputs() {
    document.getElementById('input-card').addEventListener('input', syncPreview);

    // 등록번호 입력은 숫자만
    ['regNoMainSuffix','mainRegNoSuffix','jointRegNoSuffix'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('input', () => {
        el.value = el.value.replace(/[^\d]/g, '').slice(0, 8);
        syncPreview();
      });
    });

    // 대출금액 포맷 (blur 시 정리)
    const loanInput = document.getElementById('loanAmount');
    loanInput.addEventListener('blur', () => {
      loanInput.value = formatNumberWithCommas(loanInput.value);
      syncPreview();
    });

    document.getElementById('productName').addEventListener('change', syncPreview);
  }

  // PDF 저장
  function downloadPdf() {
    const element = document.getElementById('pdfArea');
    const opt = {
      margin:       15,
      filename:     '업무지원_확인서.pdf',
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 2 },
      jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(element).save();
  }

  // 엑셀 저장
  function downloadExcel() {
    const get = id => document.getElementById(id).value.trim();
    const loanDigits = document.getElementById('loanAmount').value.replace(/[^\d]/g, '');
    const productSelect = document.getElementById('productName');

    const rows = [];
    rows.push(['업무지원 확인서']);
    rows.push([]);
    rows.push(['1. 대출 실행 계약 정보']);
    rows.push(['구분', '내용']);
    rows.push(['금융기관', get('financialInstitution')]);
    rows.push(['상품명', productSelect.value || '']);
    rows.push(['대출금액(원)', loanDigits]);
    rows.push(['실행일자', get('execDate')]);
    rows.push(['등록번호(주모집자)', formatRegWithPrefix('regNoMainSuffix')]);
    rows.push(['단체협의번호(집단대출)', get('groupNo')]);
    rows.push([]);
    rows.push(['2. 업무지원 참여자']);
    rows.push(['구분', '등록번호', '성명', '서명(수기작성)']);
    rows.push(['주모집자', formatRegWithPrefix('mainRegNoSuffix'), get('mainName'), get('mainSign')]);
    rows.push(['공동모집자', formatRegWithPrefix('jointRegNoSuffix'), get('jointName'), get('jointSign')]);
    rows.push([]);
    rows.push(['3. 내부 정산 규정']);
    rows.push(['1) 업무지원 건의 수수료 배분은 회사 규정에 따라 주모집자 60%, 공동모집자 40% 비율로 고정하여 산정합니다.']);
    rows.push(['2) 대출실행계약과 관련한 민원, 리스크, 패널티는 주모집자에게 귀속됩니다.']);
    rows.push(['3) 본 문서는 관련 법령 및 회사 규정에 따라 5년간 보관됩니다.']);
    rows.push([]);
    rows.push(['모기지리더스', get('teamNumber') + '팀', '관리팀장: ' + get('managerName')]);

    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(rows);
    XLSX.utils.book_append_sheet(wb, ws, '업무지원확인서');
    XLSX.writeFile(wb, '업무지원_확인서.xlsx');
  }

  // 입력 초기화
  function resetForm() {
    if (!confirm('입력 내용을 모두 지우시겠습니까?')) return;
    const inputs = document.querySelectorAll('#input-card input');
    inputs.forEach(i => i.value = '');
    document.getElementById('financialInstitution').value = '신한은행';
    document.getElementById('productName').value = '';
    syncPreview();
  }

  function bindButtons() {
    document.getElementById('btnPdf').addEventListener('click', downloadPdf);
    document.getElementById('btnExcel').addEventListener('click', downloadExcel);
    document.getElementById('btnReset').addEventListener('click', resetForm);
  }

  (function init() {
    bindInputs();
    bindButtons();
    syncPreview();
  })();
</script>
</body>
</html>
